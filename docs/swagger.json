{
    "swagger": "2.0",
    "info": {
        "description": "Voice-first message dispatch daemon — interprets audio/text inputs and routes structured commands to target services.",
        "title": "Switchyard API",
        "termsOfService": "https://github.com/nadzzz/switchyard",
        "contact": {
            "name": "Switchyard Maintainers",
            "url": "https://github.com/nadzzz/switchyard/issues"
        },
        "license": {
            "name": "MIT",
            "url": "https://github.com/nadzzz/switchyard/blob/main/LICENSE"
        },
        "version": "0.1.0"
    },
    "host": "localhost:8080",
    "basePath": "/",
    "paths": {
        "/dispatch": {
            "post": {
                "description": "Accepts a JSON message (with optional pre-transcribed text or base64 audio) or raw audio bytes.\nThe message is run through the interpreter pipeline (transcribe → interpret) and the resulting\ncommands are routed to the configured target services.\n\nThe instruction.response_mode field controls natural-language output:\n- \"none\"       — dispatch results only (no NL response)\n- \"text\"       — text response only\n- \"audio\"      — TTS-synthesized audio only (base64 in response_audio)\n- \"text+audio\" — both text and audio (default when TTS is enabled)",
                "consumes": [
                    "application/json",
                    "audio/wav",
                    "audio/ogg"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "dispatch"
                ],
                "summary": "Dispatch a voice or text command",
                "parameters": [
                    {
                        "description": "Dispatch request (JSON). For raw audio, POST the bytes directly with the appropriate Content-Type.",
                        "name": "message",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/github_com_nadzzz_switchyard_internal_message.Message"
                        }
                    },
                    {
                        "type": "string",
                        "description": "Sender identifier (used with raw audio uploads)",
                        "name": "X-Switchyard-Source",
                        "in": "header"
                    },
                    {
                        "type": "string",
                        "description": "JSON-encoded Instruction (used with raw audio uploads)",
                        "name": "X-Switchyard-Instruction",
                        "in": "header"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Dispatch result with optional NL response based on response_mode",
                        "schema": {
                            "$ref": "#/definitions/github_com_nadzzz_switchyard_internal_message.DispatchResult"
                        }
                    },
                    "400": {
                        "description": "Invalid request body or headers",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "500": {
                        "description": "Internal processing error",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "github_com_nadzzz_switchyard_internal_message.Command": {
            "type": "object",
            "properties": {
                "action": {
                    "description": "Action is the command verb (e.g., \"turn_on\", \"move_to\", \"set_temperature\").",
                    "type": "string"
                },
                "params": {
                    "description": "Params holds action-specific parameters.",
                    "type": "object",
                    "additionalProperties": {}
                },
                "raw": {
                    "description": "Raw is the original JSON as returned by the LLM, preserved for forwarding.",
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                }
            }
        },
        "github_com_nadzzz_switchyard_internal_message.DispatchResult": {
            "type": "object",
            "properties": {
                "commands": {
                    "description": "Commands is the list of interpreted commands.",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/github_com_nadzzz_switchyard_internal_message.Command"
                    }
                },
                "error": {
                    "description": "Error is set if processing failed at any stage.",
                    "type": "string"
                },
                "language": {
                    "description": "Language is the ISO-639-1 code detected during transcription (e.g., \"en\", \"fr\", \"es\").",
                    "type": "string"
                },
                "message_id": {
                    "description": "MessageID is the original message ID.",
                    "type": "string"
                },
                "response_audio": {
                    "description": "ResponseAudio is the TTS-synthesized audio as a base64-encoded string.\nPopulated when response_mode is \"audio\" or \"text+audio\".",
                    "type": "string"
                },
                "response_content_type": {
                    "description": "ResponseContentType is the MIME type of ResponseAudio (e.g., \"audio/wav\").",
                    "type": "string"
                },
                "response_text": {
                    "description": "ResponseText is a natural-language confirmation (in the detected language).\nPopulated when response_mode is \"text\" or \"text+audio\".",
                    "type": "string"
                },
                "routed_to": {
                    "description": "RoutedTo lists the targets that received the commands.",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "transcript": {
                    "description": "Transcript is the text produced by audio transcription (empty if text input).",
                    "type": "string"
                }
            }
        },
        "github_com_nadzzz_switchyard_internal_message.Instruction": {
            "type": "object",
            "properties": {
                "command_format": {
                    "description": "CommandFormat specifies the desired command output schema\n(e.g., \"homeassistant\", \"json\", \"ros2\").",
                    "type": "string"
                },
                "prompt": {
                    "description": "Prompt is additional context for the LLM interpreter (e.g., \"return motor commands\").",
                    "type": "string"
                },
                "response_mode": {
                    "description": "ResponseMode controls the natural-language response output:\n  \"none\"       — no NL response (dispatch results only)\n  \"text\"       — text response only\n  \"audio\"      — TTS-synthesized audio only\n  \"text+audio\" — both text and audio\nDefaults to \"text\" when TTS is disabled, \"text+audio\" when TTS is enabled.",
                    "allOf": [
                        {
                            "$ref": "#/definitions/github_com_nadzzz_switchyard_internal_message.ResponseMode"
                        }
                    ]
                },
                "targets": {
                    "description": "Targets lists the services that should receive the interpreted commands.\nThe original sender always receives the response regardless of this list.",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/github_com_nadzzz_switchyard_internal_message.Target"
                    }
                }
            }
        },
        "github_com_nadzzz_switchyard_internal_message.Message": {
            "type": "object",
            "properties": {
                "audio": {
                    "description": "Audio is the raw audio payload. Nil if the message is text-only.",
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                },
                "content_type": {
                    "description": "ContentType is the MIME type of the audio (e.g., \"audio/wav\", \"audio/ogg\").",
                    "type": "string"
                },
                "id": {
                    "description": "ID is a unique identifier for this message (UUID).",
                    "type": "string"
                },
                "instruction": {
                    "description": "Instruction tells switchyard how to interpret and route the response.",
                    "allOf": [
                        {
                            "$ref": "#/definitions/github_com_nadzzz_switchyard_internal_message.Instruction"
                        }
                    ]
                },
                "source": {
                    "description": "Source identifies the sender (e.g., \"robot-arm-01\", \"phone-alice\").",
                    "type": "string"
                },
                "text": {
                    "description": "Text is an optional pre-transcribed text input (bypasses transcription).",
                    "type": "string"
                },
                "timestamp": {
                    "description": "Timestamp is when the message was received by switchyard.",
                    "type": "string"
                }
            }
        },
        "github_com_nadzzz_switchyard_internal_message.ResponseMode": {
            "type": "string",
            "enum": [
                "none",
                "text",
                "audio",
                "text+audio"
            ],
            "x-enum-varnames": [
                "ResponseModeNone",
                "ResponseModeText",
                "ResponseModeAudio",
                "ResponseModeTextAudio"
            ]
        },
        "github_com_nadzzz_switchyard_internal_message.Target": {
            "type": "object",
            "properties": {
                "endpoint": {
                    "description": "Endpoint is the address to reach this target (e.g., \"http://ha.local:8123/api/services\").",
                    "type": "string"
                },
                "format_template": {
                    "description": "FormatTemplate is an optional Go template to transform commands before sending.",
                    "type": "string"
                },
                "protocol": {
                    "description": "Protocol is the protocol to use (\"http\", \"grpc\", \"mqtt\").",
                    "type": "string"
                },
                "service_name": {
                    "description": "ServiceName is a human-readable identifier (e.g., \"homeassistant\", \"robot\").",
                    "type": "string"
                }
            }
        }
    },
    "externalDocs": {
        "description": "Switchyard README",
        "url": "https://github.com/nadzzz/switchyard"
    }
}